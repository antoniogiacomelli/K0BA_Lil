<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.12.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>K0BA: C:/Github/K0BAL/Core/ThreadSafe/stm32_lock.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">K0BA<span id="projectnumber">&#160;v0.1.0</span>
   </div>
   <div id="projectbrief">Kernel 0 for emBedded Applications</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.12.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',false);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){ initResizable(false); });
/* @license-end */
</script>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_c6310732a22f63c0c2fc5595561e68f1.html">Core</a></li><li class="navelem"><a class="el" href="dir_cef551cedc21611bf23fe687249bbf34.html">ThreadSafe</a></li>  </ul>
</div>
</div><!-- top -->
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">stm32_lock.h File Reference</div></div>
</div><!--header-->
<div class="contents">

<p>STMicroelectronics lock mechanisms.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;stdint.h&gt;</code><br />
<code>#include &lt;stddef.h&gt;</code><br />
<code>#include &lt;cmsis_compiler.h&gt;</code><br />
</div>
<p><a href="stm32__lock_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="nested-classes" name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct_locking_data__t.html">LockingData_t</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="define-members" name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a0d0ff72332b1d8bdaded5e903f0d2c35" id="r_a0d0ff72332b1d8bdaded5e903f0d2c35"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a0d0ff72332b1d8bdaded5e903f0d2c35">STM32_THREAD_SAFE_STRATEGY</a>&#160;&#160;&#160;2</td></tr>
<tr class="separator:a0d0ff72332b1d8bdaded5e903f0d2c35"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afa240782c75db9d49e1bc2b6a347ee04" id="r_afa240782c75db9d49e1bc2b6a347ee04"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#afa240782c75db9d49e1bc2b6a347ee04">STM32_LOCK_BLOCK</a>()</td></tr>
<tr class="separator:afa240782c75db9d49e1bc2b6a347ee04"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae716adb5cd387af9aa2a4a59f02bf68e" id="r_ae716adb5cd387af9aa2a4a59f02bf68e"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ae716adb5cd387af9aa2a4a59f02bf68e">STM32_LOCK_BLOCK_IF_NULL_ARGUMENT</a>(x)</td></tr>
<tr class="separator:ae716adb5cd387af9aa2a4a59f02bf68e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4072a9f8922af3687b39ba125f5eeb9d" id="r_a4072a9f8922af3687b39ba125f5eeb9d"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a4072a9f8922af3687b39ba125f5eeb9d">STM32_LOCK_BLOCK_IF_INTERRUPT_CONTEXT</a>()</td></tr>
<tr class="separator:a4072a9f8922af3687b39ba125f5eeb9d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abb28672c724e84d7d3356e614182dcbc" id="r_abb28672c724e84d7d3356e614182dcbc"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#abb28672c724e84d7d3356e614182dcbc">STM32_LOCK_UNUSED</a>(var)</td></tr>
<tr class="separator:abb28672c724e84d7d3356e614182dcbc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a32b6553a8a0d5e168c7161a651e07767" id="r_a32b6553a8a0d5e168c7161a651e07767"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a32b6553a8a0d5e168c7161a651e07767">STM32_LOCK_ARRAY_SIZE</a>(array)</td></tr>
<tr class="separator:a32b6553a8a0d5e168c7161a651e07767"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4e4b87c591da0b9cad51ba7e6b5e465a" id="r_a4e4b87c591da0b9cad51ba7e6b5e465a"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a4e4b87c591da0b9cad51ba7e6b5e465a">LOCKING_DATA_INIT</a>&#160;&#160;&#160;{ 0, 0 }</td></tr>
<tr class="separator:a4e4b87c591da0b9cad51ba7e6b5e465a"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a1730ffe1e560465665eb47d9264826f9" id="r_a1730ffe1e560465665eb47d9264826f9"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a1730ffe1e560465665eb47d9264826f9">Error_Handler</a> (void)</td></tr>
<tr class="memdesc:a1730ffe1e560465665eb47d9264826f9"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function is executed in case of error occurrence.  <br /></td></tr>
<tr class="separator:a1730ffe1e560465665eb47d9264826f9"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>STMicroelectronics lock mechanisms. </p>
<dl class="section author"><dt>Author</dt><dd>STMicroelectronics </dd></dl>
<p>This implementation supports the following strategies for handling thread-safe locks. The strategy can be explicitly selected by defining <code>\STM32_THREAD_SAFE_STRATEGY = &lt;number&gt;</code> in the project. Please look at the '&lt;toolchain/library&gt;_lock_glue.c' file for more details.</p>
<ol type="1">
<li>User defined thread-safe implementation. User defined solution for handling thread-safety. <br  />
 <b>NOTE:</b> The stubs in stm32_lock_user.h needs to be implemented to gain thread-safety.</li>
<li>[<b>DEFAULT</b>] Allow lock usage from interrupts. This implementation will ensure thread-safety by disabling all interrupts during e.g. calls to malloc. <br  />
 <b>NOTE:</b> Disabling all interrupts creates interrupt latency which might not be desired for this application!</li>
<li>Deny lock usage from interrupts. This implementation assumes single thread of execution. <br  />
 <b>NOTE:</b> Thread-safety dependent functions will enter an infinity loop if used in interrupt context.</li>
<li>Allow lock usage from interrupts. Implemented using FreeRTOS locks. This implementation will ensure thread-safety by entering RTOS ISR capable critical sections during e.g. calls to malloc. By default this implementation supports 2 levels of recursive locking. Adding additional levels requires 4 bytes per lock per level of RAM. <br  />
 <b>NOTE:</b> Interrupts with high priority are not disabled. This implies that the lock is not thread-safe from high priority interrupts!</li>
<li>Deny lock usage from interrupts. Implemented using FreeRTOS locks. This implementation will ensure thread-safety by suspending all tasks during e.g. calls to malloc. <br  />
 <b>NOTE:</b> Thread-safety dependent functions will enter an infinity loop if used in interrupt context.</li>
</ol>
<dl class="section attention"><dt>Attention</dt><dd></dd></dl>
<p>Copyright (c) 2023 STMicroelectronics. All rights reserved.</p>
<p>This software is licensed under terms that can be found in the LICENSE file in the root directory of this software component. If no LICENSE file comes with this software, it is provided AS-IS. </p>

<p class="definition">Definition in file <a class="el" href="stm32__lock_8h_source.html">stm32_lock.h</a>.</p>
</div><h2 class="groupheader">Macro Definition Documentation</h2>
<a id="a4e4b87c591da0b9cad51ba7e6b5e465a" name="a4e4b87c591da0b9cad51ba7e6b5e465a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4e4b87c591da0b9cad51ba7e6b5e465a">&#9670;&#160;</a></span>LOCKING_DATA_INIT</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define LOCKING_DATA_INIT&#160;&#160;&#160;{ 0, 0 }</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Initialize members in instance of <code><a class="el" href="struct_locking_data__t.html">LockingData_t</a></code> structure </p>

<p class="definition">Definition at line <a class="el" href="stm32__lock_8h_source.html#l00134">134</a> of file <a class="el" href="stm32__lock_8h_source.html">stm32_lock.h</a>.</p>

</div>
</div>
<a id="a32b6553a8a0d5e168c7161a651e07767" name="a32b6553a8a0d5e168c7161a651e07767"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a32b6553a8a0d5e168c7161a651e07767">&#9670;&#160;</a></span>STM32_LOCK_ARRAY_SIZE</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define STM32_LOCK_ARRAY_SIZE</td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>array</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Value:</b><div class="fragment"><div class="line">(<span class="keyword">sizeof</span>(array) / <span class="keyword">sizeof</span>((array)[0]))</div>
</div><!-- fragment --><p>Size of array </p>

<p class="definition">Definition at line <a class="el" href="stm32__lock_8h_source.html#l00114">114</a> of file <a class="el" href="stm32__lock_8h_source.html">stm32_lock.h</a>.</p>

</div>
</div>
<a id="afa240782c75db9d49e1bc2b6a347ee04" name="afa240782c75db9d49e1bc2b6a347ee04"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afa240782c75db9d49e1bc2b6a347ee04">&#9670;&#160;</a></span>STM32_LOCK_BLOCK</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define STM32_LOCK_BLOCK</td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Value:</b><div class="fragment"><div class="line">  <span class="keywordflow">do</span>                                            \</div>
<div class="line">  {                                             \</div>
<div class="line">    __disable_irq();                            \</div>
<div class="line">    Error_Handler();                            \</div>
<div class="line">    while (1);                                  \</div>
<div class="line">  } <span class="keywordflow">while</span> (0)</div>
</div><!-- fragment --><p>Blocks execution </p>

<p class="definition">Definition at line <a class="el" href="stm32__lock_8h_source.html#l00082">82</a> of file <a class="el" href="stm32__lock_8h_source.html">stm32_lock.h</a>.</p>

</div>
</div>
<a id="a4072a9f8922af3687b39ba125f5eeb9d" name="a4072a9f8922af3687b39ba125f5eeb9d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4072a9f8922af3687b39ba125f5eeb9d">&#9670;&#160;</a></span>STM32_LOCK_BLOCK_IF_INTERRUPT_CONTEXT</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define STM32_LOCK_BLOCK_IF_INTERRUPT_CONTEXT</td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Value:</b><div class="fragment"><div class="line">  <span class="keywordflow">do</span>                                            \</div>
<div class="line">  {                                             \</div>
<div class="line">    if (__get_IPSR())                           \</div>
<div class="line">    {                                           \</div>
<div class="line">      STM32_LOCK_BLOCK();                       \</div>
<div class="line">    }                                           \</div>
<div class="line">  } <span class="keywordflow">while</span> (0)</div>
</div><!-- fragment --><p>Blocks execution if in interrupt context </p>

<p class="definition">Definition at line <a class="el" href="stm32__lock_8h_source.html#l00101">101</a> of file <a class="el" href="stm32__lock_8h_source.html">stm32_lock.h</a>.</p>

</div>
</div>
<a id="ae716adb5cd387af9aa2a4a59f02bf68e" name="ae716adb5cd387af9aa2a4a59f02bf68e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae716adb5cd387af9aa2a4a59f02bf68e">&#9670;&#160;</a></span>STM32_LOCK_BLOCK_IF_NULL_ARGUMENT</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define STM32_LOCK_BLOCK_IF_NULL_ARGUMENT</td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>x</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Value:</b><div class="fragment"><div class="line">  <span class="keywordflow">do</span>                                            \</div>
<div class="line">  {                                             \</div>
<div class="line">    if ((x) == NULL)                            \</div>
<div class="line">    {                                           \</div>
<div class="line">      STM32_LOCK_BLOCK();                       \</div>
<div class="line">    }                                           \</div>
<div class="line">  } <span class="keywordflow">while</span> (0)</div>
</div><!-- fragment --><p>Blocks execution if argument is NULL </p>

<p class="definition">Definition at line <a class="el" href="stm32__lock_8h_source.html#l00091">91</a> of file <a class="el" href="stm32__lock_8h_source.html">stm32_lock.h</a>.</p>

</div>
</div>
<a id="abb28672c724e84d7d3356e614182dcbc" name="abb28672c724e84d7d3356e614182dcbc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abb28672c724e84d7d3356e614182dcbc">&#9670;&#160;</a></span>STM32_LOCK_UNUSED</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define STM32_LOCK_UNUSED</td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>var</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Value:</b><div class="fragment"><div class="line">(void)var</div>
</div><!-- fragment --><p>Hide unused parameter warning from compiler </p>

<p class="definition">Definition at line <a class="el" href="stm32__lock_8h_source.html#l00111">111</a> of file <a class="el" href="stm32__lock_8h_source.html">stm32_lock.h</a>.</p>

</div>
</div>
<a id="a0d0ff72332b1d8bdaded5e903f0d2c35" name="a0d0ff72332b1d8bdaded5e903f0d2c35"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0d0ff72332b1d8bdaded5e903f0d2c35">&#9670;&#160;</a></span>STM32_THREAD_SAFE_STRATEGY</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define STM32_THREAD_SAFE_STRATEGY&#160;&#160;&#160;2</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Assume strategy 2 if not specified </p>

<p class="definition">Definition at line <a class="el" href="stm32__lock_8h_source.html#l00070">70</a> of file <a class="el" href="stm32__lock_8h_source.html">stm32_lock.h</a>.</p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="a1730ffe1e560465665eb47d9264826f9" name="a1730ffe1e560465665eb47d9264826f9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1730ffe1e560465665eb47d9264826f9">&#9670;&#160;</a></span>Error_Handler()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Error_Handler </td>
          <td>(</td>
          <td class="paramtype">void</td>          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function is executed in case of error occurrence. </p>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">None</td><td></td></tr>
  </table>
  </dd>
</dl>
<p>This function is executed in case of error occurrence. </p>

<p class="definition">Definition at line <a class="el" href="main_8c_source.html#l00268">268</a> of file <a class="el" href="main_8c_source.html">main.c</a>.</p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.12.0
</small></address>
</div><!-- doc-content -->
</body>
</html>
